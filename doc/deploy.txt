Nginx Deployment Guide
This guide will help you deploy your Next.js airdrop application to a production server with Nginx.

Prerequisites
Ubuntu/Debian server (or similar Linux distribution)
Node.js 18+ installed
Nginx installed
MySQL database set up
Domain name pointed to your server (optional, for SSL)
Step 1: Prepare Your Server
Install Required Software
# Update system packages
sudo apt update && sudo apt upgrade -y
# Install Node.js 18+ (using NodeSource)
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt install -y nodejs
# Install Nginx
sudo apt install -y nginx
# Install MySQL (if not already installed)
sudo apt install -y mysql-server
# Install PM2 (process manager for Node.js)
sudo npm install -g pm2
Step 2: Set Up MySQL Database
# Login to MySQL
sudo mysql -u root -p
# Create database and user
CREATE DATABASE airdrop;
CREATE USER 'airdrop_user'@'localhost' IDENTIFIED BY 'your_secure_password';
GRANT ALL PRIVILEGES ON airdrop.* TO 'airdrop_user'@'localhost';
FLUSH PRIVILEGES;
EXIT;
Step 3: Deploy Your Application
Clone or Upload Your Code
# Create application directory
sudo mkdir -p /var/www/airdrop
sudo chown -R $USER:$USER /var/www/airdrop
# Navigate to directory
cd /var/www/airdrop
# If using Git:
git clone https://github.com/yourusername/airdrop.git .
# Or upload your code using SCP/SFTP
Set Up Environment Variables
# Create production .env file
nano .env
Add the following (replace with your actual values):

# Database
DATABASE_URL="mysql://airdrop_user:your_secure_password@localhost:3306/airdrop"
# NextAuth
AUTH_SECRET="your-generated-secret-here"
NEXTAUTH_URL="https://yourdomain.com"
# Optional
NODE_ENV="production"
IMPORTANT

Generate a secure AUTH_SECRET with: openssl rand -base64 32

Install Dependencies and Build
# Install dependencies
npm install
# Generate Prisma client
npx prisma generate
# Run database migrations
npx prisma migrate deploy
# Seed the database (creates admin user)
npx tsx prisma/seed.ts
# Build the application
npm run build
Step 4: Set Up PM2
PM2 will keep your Next.js application running and restart it if it crashes.

# Start the application with PM2
pm2 start npm --name "airdrop" -- start
# Save PM2 configuration
pm2 save
# Set PM2 to start on system boot
pm2 startup
# Follow the instructions provided by the command above
Useful PM2 Commands
# View application status
pm2 status
# View logs
pm2 logs airdrop
# Restart application
pm2 restart airdrop
# Stop application
pm2 stop airdrop
# Monitor resources
pm2 monit
Step 5: Configure Nginx
Create Nginx Configuration
# Create new Nginx site configuration
sudo nano /etc/nginx/sites-available/airdrop
Add the following configuration:

# Upstream to Next.js application
upstream nextjs_airdrop {
    server 127.0.0.1:3000;
    keepalive 64;
}
# HTTP server (redirects to HTTPS)
server {
    listen 80;
    listen [::]:80;
    server_name yourdomain.com www.yourdomain.com;
    # Redirect all HTTP traffic to HTTPS
    return 301 https://$server_name$request_uri;
}
# HTTPS server
server {
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    server_name yourdomain.com www.yourdomain.com;
    # SSL certificates (will be configured with Certbot)
    ssl_certificate /etc/letsencrypt/live/yourdomain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/yourdomain.com/privkey.pem;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;
    # Security headers
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    # Logging
    access_log /var/log/nginx/airdrop-access.log;
    error_log /var/log/nginx/airdrop-error.log;
    # Client body size (for file uploads)
    client_max_body_size 10M;
    # Proxy settings
    location / {
        proxy_pass http://nextjs_airdrop;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
        
        # Timeouts
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }
    # Static files caching
    location /_next/static {
        proxy_pass http://nextjs_airdrop;
        proxy_cache_valid 200 60m;
        add_header Cache-Control "public, max-age=3600, immutable";
    }
    # Public files
    location /public {
        proxy_pass http://nextjs_airdrop;
        add_header Cache-Control "public, max-age=3600";
    }
}
Enable the Site
# Create symbolic link to enable site
sudo ln -s /etc/nginx/sites-available/airdrop /etc/nginx/sites-enabled/
# Remove default site (optional)
sudo rm /etc/nginx/sites-enabled/default
# Test Nginx configuration
sudo nginx -t
# Reload Nginx
sudo systemctl reload nginx
Step 6: Set Up SSL with Let's Encrypt (Optional but Recommended)
# Install Certbot
sudo apt install -y certbot python3-certbot-nginx
# Obtain SSL certificate
sudo certbot --nginx -d yourdomain.com -d www.yourdomain.com
# Follow the prompts to complete SSL setup
# Test automatic renewal
sudo certbot renew --dry-run
NOTE

Certbot will automatically update your Nginx configuration with SSL certificates.

Step 7: Configure Firewall
# Allow Nginx through firewall
sudo ufw allow 'Nginx Full'
# Allow SSH (if not already allowed)
sudo ufw allow OpenSSH
# Enable firewall
sudo ufw enable
# Check status
sudo ufw status
Step 8: Verify Deployment
Visit your domain: https://yourdomain.com
Test the admin login: https://yourdomain.com/login
Login with: admin@example.com / password123
Change the admin password immediately!
Updating Your Application
When you need to update your application:

# Navigate to application directory
cd /var/www/airdrop
# Pull latest changes (if using Git)
git pull
# Install any new dependencies
npm install
# Regenerate Prisma client (if schema changed)
npx prisma generate
# Run migrations (if any)
npx prisma migrate deploy
# Rebuild application
npm run build
# Restart PM2
pm2 restart airdrop
Troubleshooting
Application Not Starting
# Check PM2 logs
pm2 logs airdrop
# Check if port 3000 is in use
sudo lsof -i :3000
# Restart application
pm2 restart airdrop
Nginx Errors
# Check Nginx error logs
sudo tail -f /var/log/nginx/airdrop-error.log
# Test Nginx configuration
sudo nginx -t
# Restart Nginx
sudo systemctl restart nginx
Database Connection Issues
# Verify MySQL is running
sudo systemctl status mysql
# Test database connection
npx prisma db pull
# Check DATABASE_URL in .env file
cat .env | grep DATABASE_URL
Permission Issues
# Fix ownership
sudo chown -R $USER:$USER /var/www/airdrop
# Fix permissions
chmod -R 755 /var/www/airdrop
Performance Optimization
Enable Gzip Compression in Nginx
Add to your Nginx configuration:

gzip on;
gzip_vary on;
gzip_min_length 1024;
gzip_types text/plain text/css text/xml text/javascript application/x-javascript application/xml+rss application/json;
PM2 Cluster Mode
For better performance, run multiple instances:

# Stop current instance
pm2 stop airdrop
# Start in cluster mode (uses all CPU cores)
pm2 start npm --name "airdrop" -i max -- start
# Save configuration
pm2 save
Security Checklist
 Change default admin password
 Set strong AUTH_SECRET
 Enable SSL/HTTPS
 Configure firewall (UFW)
 Keep system packages updated
 Regularly backup database
 Monitor application logs
 Set up automated backups for database
Backup Strategy
Database Backup
# Create backup script
nano /home/$USER/backup-db.sh
Add:

#!/bin/bash
BACKUP_DIR="/home/$USER/backups"
DATE=$(date +%Y%m%d_%H%M%S)
mkdir -p $BACKUP_DIR
mysqldump -u airdrop_user -p'your_password' airdrop > $BACKUP_DIR/airdrop_$DATE.sql
# Keep only last 7 days of backups
find $BACKUP_DIR -name "airdrop_*.sql" -mtime +7 -delete
# Make executable
chmod +x /home/$USER/backup-db.sh
# Add to crontab (daily at 2 AM)
crontab -e
# Add: 0 2 * * * /home/$USER/backup-db.sh
Monitoring
Set Up PM2 Monitoring
# Link to PM2 Plus (optional)
pm2 link [secret-key] [public-key]
# Or use basic monitoring
pm2 monit
Nginx Access Logs
# View real-time access logs
sudo tail -f /var/log/nginx/airdrop-access.log
# Analyze logs
sudo goaccess /var/log/nginx/airdrop-access.log -o report.html --log-format=COMBINED
Support
If you encounter issues:

Check application logs: pm2 logs airdrop
Check Nginx logs: sudo tail -f /var/log/nginx/airdrop-error.log
Verify environment variables in .env
Ensure database is accessible
Check firewall settings
Your application should now be successfully deployed and running on Nginx!