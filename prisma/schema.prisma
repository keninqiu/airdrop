generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  name      String?
  role      String   @default("USER") // USER, ADMIN
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  submissions UserAirdropListing[]
}

enum RewardModel {
  per_wallet
  reward_pool
  hybrid
}

model Airdrop {
  id             Int          @id @default(autoincrement())
  logo           String
  value          String
  status         String       // Active, Upcoming, Ended
  type           String       // Featured, DeFi, Meme, Exchange, Layer 2, Layer 1
  website_url    String?
  campaign_url   String?
  whitepaper_url String?
  reward_model   RewardModel?
  reward_amount  String?
  campaign_start DateTime?
  campaign_end   DateTime?
  campaign_requirement String? @db.Text
  blockchain     String? @db.Text
  source         String? // Where the airdrop was found
  external_id    String? @unique // ID from source system
  approved       Boolean @default(false) // Admin approval status
  crawled_at     DateTime? // When it was crawled
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  translations   AirdropTranslation[]
}

model AirdropTranslation {
  id          Int      @id @default(autoincrement())
  airdropId   Int
  locale      String
  name        String
  description String   @db.Text
  steps       String?  @db.Text
  airdrop     Airdrop  @relation(fields: [airdropId], references: [id], onDelete: Cascade)

  @@unique([airdropId, locale])
}

model Post {
  id           Int      @id @default(autoincrement())
  image        String
  link         String
  published    Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  translations PostTranslation[]
}

model PostTranslation {
  id          Int      @id @default(autoincrement())
  postId      Int
  locale      String
  title       String
  description String   @db.Text
  post        Post     @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@unique([postId, locale])
}

model UserAirdropListing {
  id             Int      @id @default(autoincrement())
  userId         Int
  user           User     @relation(fields: [userId], references: [id])
  
  // Core fields matching Airdrop model but for user submission
  logo           String?  // Optional for user submission, maybe they provide a URL
  value          String?
  status         String   @default("Pending") // Pending, Approved, Rejected
  type           String?
  website_url    String?
  campaign_url   String?
  whitepaper_url String?
  reward_model   RewardModel?
  reward_amount  String?
  campaign_start DateTime?
  campaign_end   DateTime?
  campaign_requirement String? @db.Text
  blockchain     String? @db.Text
  
  // Admin fields
  rejection_reason String? @db.Text
  
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  translations   UserAirdropListingTranslation[]
}

model UserAirdropListingTranslation {
  id          Int      @id @default(autoincrement())
  listingId   Int
  locale      String
  name        String
  description String   @db.Text
  steps       String?  @db.Text
  listing     UserAirdropListing @relation(fields: [listingId], references: [id], onDelete: Cascade)

  @@unique([listingId, locale])
}

model Exchange {
  id              Int      @id @default(autoincrement())
  name            String
  logo            String
  url             String
  affiliateUrl    String?
  features        String?  @db.Text // JSON array of features
  tradingVolume   String?
  kycRequired     Boolean  @default(false)
  rating          Float?
  sortOrder       Int      @default(0)
  published       Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  translations    ExchangeTranslation[]
}

model ExchangeTranslation {
  id          Int      @id @default(autoincrement())
  exchangeId  Int
  locale      String
  description String   @db.Text
  exchange    Exchange @relation(fields: [exchangeId], references: [id], onDelete: Cascade)

  @@unique([exchangeId, locale])
}
